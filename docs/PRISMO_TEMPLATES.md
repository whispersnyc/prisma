# Prismo Template System

Prismo uses the `.prismo` template format for applying color schemes to applications, supporting both complete file replacement and line-specific/pattern-based updates.

## Quick Start

### Creating a .prismo Template

1. Create a new file in `resources/templates/` with `.prismo` extension
2. Add directives to specify what to update
3. Use color variables like `{color0}`, `{background}`, `{color1.r}`, etc.

Example:
```prismo
# My App Theme

@match ".*background.*"
background = #{background}

@match ".*foreground.*"
foreground = #{foreground}
```

### Adding Template to Config

Edit `config.yaml` and add your template with the target output path:

```yaml
templates:
    filename: ~/.config/myapp/theme.conf
```

Note: The target output path is **always** specified in `config.yaml`, not in the template file. Paths support environment variables and home directory expansion.

## Directives Reference

### @full
Replace the entire file contents with the template content.

```prismo
@full
/* Complete file replacement */
:root {
  --bg: #{background};
  --fg: #{foreground};
}
```

### @line
Replace a specific line number (1-indexed).

```prismo
@line 42
new content for line 42 with #{color1}
```

### @lines
Replace a range of lines (inclusive).

```prismo
@lines 10-15
line 10 content
line 11 content
line 12 content
```

### @match
Replace all lines matching a regex pattern (line-by-line by default).

```prismo
@match ".*primary-color.*"
primary-color = #{color4}
```

### @match multiline
Replace all matches across multiple lines. Useful for JSON objects, code blocks, or any multi-line structures.

```prismo
# Delete a multi-line JSON object containing "name": "Pywal"
@match multiline "\s*\{[^}]*\"name\"\s*:\s*\"Pywal\"[^}]*\},?\s*"

```

**Note:** In multiline mode, the pattern uses `re.DOTALL` flag, so `.` matches newlines.

### @append
Add content to the end of the file.

```prismo
@append
# Generated by Prismo
# Date: 2024
```

### @prepend
Add content to the beginning of the file.

```prismo
@prepend
# Prismo Theme Configuration
```

## Color Variables

### Full Color Values
- `{background}` - Background color (hex without #, e.g., `a1b2c3`)
- `{foreground}` - Foreground color (hex without #, e.g., `ffffff`)
- `{cursor}` - Cursor color (hex without #)
- `{color0}` through `{color15}` - 16 ANSI colors (hex without #)

**Note:** Color variables return hex values **without** the leading `#` for maximum applicability. Add `#` in your template where needed (e.g., `#{color0}` for CSS, `"#{color1}"` for JSON).

### RGB Components (0-255)
- `{color0.r}` - Red component
- `{color0.g}` - Green component
- `{color0.b}` - Blue component

### HLS Components
- `{color0.h}` - Hue (0-360)
- `{color0.l}` - Lightness (0-100%)
- `{color0.s}` - Saturation (0-100%)

## Examples

### Example 1: VSCode Settings

config.yaml:
```yaml
templates:
    vscode.prismo: ~/.vscode/settings.json
```

vscode.prismo:
```prismo
@match ".*workbench.colorCustomizations.*"
    "workbench.colorCustomizations": {
        "editor.background": "#{background}",
        "editor.foreground": "#{foreground}"
    }
```

### Example 2: Terminal Config

config.yaml:
```yaml
templates:
    terminal.prismo: ~/.config/terminal/config.toml
```

terminal.prismo:
```prismo
@match ".*\[colors\].*"
[colors]

@match ".*background.*"
background = "#{background}"

@match ".*foreground.*"
foreground = "#{foreground}"
```

### Example 3: Using RGB Components

config.yaml:
```yaml
templates:
    theme.prismo: ~/.config/app/theme.css
```

theme.prismo:
```prismo
@match ".*--primary-color.*"
--primary-color: rgb({color1.r}, {color1.g}, {color1.b});

@match ".*--accent-hue.*"
--accent-hue: {color4.h};
```

### Example 4: Full File Replacement

config.yaml:
```yaml
templates:
    simple-theme.prismo: ~/my-app/theme.css
```

simple-theme.prismo:
```prismo
@full
/* Generated by Prismo */
:root {
  --background: #{background};
  --foreground: #{foreground};
  --accent: #{color4};
}

body {
  background-color: var(--background);
  color: var(--foreground);
}
```

## Tips and Tricks

### 1. Pattern Matching Tips
- Use `.*` to match any characters
- Escape special regex characters: `.`, `*`, `[`, `]`, etc.
- Use `\s*` to allow optional whitespace
- Be specific to avoid unwanted matches

### 2. Working with JSON
Match JSON properties carefully:
```prismo
@match ".*\"background\":\s*\"#[0-9a-fA-F]{6}\".*"
        "background": "#{background}",
```

### 3. Working with INI/TOML
Match section headers and keys:
```prismo
@match ".*\[colors\].*"
[colors]

@match ".*background\s*=.*"
background = #{background}
```

### 4. Debugging Templates
- Start with simple patterns and test
- Check the output file after applying
- Use the CLI to see errors: `prismo -t yourtemplate.prismo`
- Look at example templates in `resources/templates/`

## Common Patterns

### Update all color definitions in CSS
```prismo
@match ".*--color-bg.*"
--color-bg: #{background};

@match ".*--color-fg.*"
--color-fg: #{foreground};
```

### Update JSON array of colors
```prismo
@match ".*\"colors\":\s*\[.*"
    "colors": ["#{color0}", "#{color1}", "#{color2}"]
```

### Replace configuration section
```prismo
@lines 50-70
# Color Configuration
bg = #{background}
fg = #{foreground}
# ... more config
```

## Choosing the Right Approach

The `.prismo` format offers flexibility for different use cases:

**Use `@full` directive when:**
- You need complete file replacement
- The entire file is a theme/color configuration
- The target file has no user-specific settings to preserve

**Use `@match`, `@line`, or `@regex` when:**
1. Updating existing config files without overwriting them
2. Working with files that have user-specific settings you want to preserve
3. Applications that auto-generate config files

To create a targeted update template:
1. Identify what parts of the file actually need color updates
2. Create `.prismo` template with `@match` directives for those sections
3. Test on a copy of your config file
4. Update `config.yaml` to use the new template

## Troubleshooting

**Error: "No target path specified"**
- Ensure the template is listed in `config.yaml` with an output path
- Check that the path is correct and not empty

**Error: "Invalid regex pattern"**
- Check your pattern for syntax errors
- Escape special characters properly
- Test your regex with a Python regex tester

**Template not applying**
- Verify template file exists in `templates/` folder
- Check `config.yaml` has correct template entry
- Ensure template name matches exactly (case-sensitive)
- Enable template in GUI or use `-t` flag in CLI

**Colors not updating**
- Check that pattern matches the target lines
- Verify color variable names are correct
- Look for typos in variable names (case-sensitive)

**Path not found errors**
- Verify environment variables are set (e.g., `%APPDATA%`)
- Use `~` instead of `HOME` for home directory
- Check if parent directories exist (they're auto-created now)

## See Also

- [TEMPLATE_FORMAT.md](TEMPLATE_FORMAT.md) - Detailed format specification
- [Example templates](resources/templates/) - Ready-to-use examples
- [config.yaml](../resources/config.yaml) - Template configuration
