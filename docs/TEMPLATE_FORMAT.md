# Prisma Template Format Specification

## Overview
Prisma templates use the `.prisma` file extension and support line-specific replacements with variable substitution.

## Syntax

### Directives
All directives start with `@` at the beginning of a line:

- `@full` - Replace the entire file with the content (NEW)
- `@line <number>` - Replace a specific line (1-indexed)
- `@lines <start>-<end>` - Replace a line range (inclusive, 1-indexed)
- `@match "<regex>"` - Replace all lines matching the regex pattern
- `@append` - Append content to the end of the file
- `@prepend` - Prepend content to the start of the file

**Note:** The `@target` directive has been removed. Output paths are now **always** specified in `config.yaml`, supporting environment variable expansion (`~`, `%userprofile%`, `$HOME`, etc.).

### Variables
Same as before, all variables are case-sensitive:

- `{colorN}` - Full hex color (e.g., `{color0}` → `#a1b2c3`)
- `{colorN.r}` - Red component 0-255
- `{colorN.g}` - Green component 0-255
- `{colorN.b}` - Blue component 0-255
- `{colorN.h}` - Hue 0-360
- `{colorN.l}` - Lightness 0-100%
- `{colorN.s}` - Saturation 0-100%

Available color names: `color0`-`color15`, `background`, `foreground`, `cursor`

### Comments
Lines starting with `#` (outside of content blocks) are comments.

## Format Structure

```prisma
# Comment

@full
Complete file replacement content
with {color0} and other variables

# OR for partial updates:

@line 10
Single line content with {color0}

@lines 20-25
Multi-line
content here
with {color1}

@match ".*theme-color.*"
Replacement for lines matching pattern

@append
Content to add at end

@prepend
Content to add at start
```

## Examples

### Example 1: Full File Replacement

config.yaml:
```yaml
templates:
    simple-theme.prisma: ~/.config/app/theme.css
```

simple-theme.prisma:
```prisma
@full
/* Generated by Prisma */
:root {
  --background: {background};
  --foreground: {foreground};
  --accent: {color4};
}
```

### Example 2: Partial Updates

config.yaml:
```yaml
templates:
    vscode.prisma: ~/.vscode/settings.json
```

vscode.prisma:
```prisma
@match ".*workbench.colorCustomizations.*"
    "workbench.colorCustomizations": {
        "editor.background": "{background}",
        "editor.foreground": "{foreground}"
    }

@lines 50-52
    "terminal.ansiBlack": "{color0}",
    "terminal.ansiRed": "{color1}",
    "terminal.ansiGreen": "{color2}"
```

## Behavior

1. Output paths are specified in `config.yaml`, **not** in the template file
2. Paths support environment variable expansion:
   - `~` → User home directory
   - `%userprofile%` → Windows user profile
   - `$HOME` → Unix home directory
   - Any other environment variables
3. Parent directories are automatically created if they don't exist
4. Content for a directive starts on the line after the directive
5. Content ends when another directive is encountered or EOF
6. Empty lines in content blocks are preserved
7. Variables are replaced before applying the operation
8. Line numbers are 1-indexed
9. If target file doesn't exist, it will be created
10. Regex patterns use Python's `re` module syntax
11. Multiple directives can be used in the same template
12. Operations are applied in the order they appear in the template
13. `@full` replaces the entire file (similar to `.txt` templates)

## Use Cases

### When to use .prisma vs .txt templates:

**Use .prisma templates when:**
- Updating specific sections of existing config files with `@match`, `@line`, etc.
- You want to preserve file structure and only modify color values
- Working with JSON, TOML, or other structured config formats
- You need regex-based pattern matching for flexible updates

**Use .prisma with @full directive when:**
- You want complete file replacement like `.txt` but with the `.prisma` format
- You're creating a new template and want consistency with other `.prisma` templates

**Use .txt templates when:**
- Maintaining legacy templates that already exist
- Simple full-file replacement without needing directive features
- The file is a complete theme/style file (like CSS)

## Best Practices

1. **Use environment variables in config.yaml**: Use `~`, `%userprofile%`, `$HOME` for portability
2. **Use @match for flexibility**: Pattern matching is more robust than line numbers
3. **Be specific with patterns**: Use enough context to avoid false matches
4. **Test your regex**: Invalid patterns will cause errors
5. **Start simple**: Begin with basic replacements, add complexity as needed
6. **Comment your templates**: Use `#` to document what each section does
7. **Use @full for simple themes**: If you need complete file replacement, use `@full` in a `.prisma` template
